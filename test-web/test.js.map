{"version":3,"sources":["webpack:///webpack/bootstrap 118e92178042978c90db","webpack:///./test/test.ts","webpack:///./src/index.ts","webpack:///./src/user-fitting.ts","webpack:///./src/draw-triangle.ts"],"names":[],"mappings":"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","file":"./test-web/test.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 118e92178042978c90db","import * as S from '../src';\r\n\r\nexport function test() {\r\n    console.log('test START');\r\n\r\n    let p0 = getProduct(0);\r\n    let p1 = getProduct(1);\r\n    let u0 = getUser(0);\r\n    let u1 = getUser(1);\r\n    let u2 = getUser(2);\r\n    let u3 = getUser(3);\r\n\r\n    addTest(p0, u0);\r\n    addTest(p0, u1);\r\n    addTest(p0, u2);\r\n    addTest(p0, u3);\r\n\r\n    addTest(p1, u0);\r\n    addTest(p1, u1);\r\n    addTest(p1, u2);\r\n    addTest(p1, u3);\r\n\r\n    console.log('test END');\r\n}\r\n\r\nfunction addTest(product: any, user: any) {\r\n    let host = document.createElement('div');\r\n    document.body.appendChild(host);\r\n    host.style.width = '300px';\r\n    host.style.height = '300px';\r\n    host.style.display = 'inline-block';\r\n\r\n    S.setupUserFitting({\r\n        host: host,\r\n        userImageUrl: user.userImageUrl,\r\n        userImageHandles: user.userImageHandles,\r\n        productImageUrl: product.productImageUrl,\r\n        productImageHandles: product.productImageHandles\r\n    });\r\n}\r\n\r\nfunction getProduct(i: number) {\r\n    if (i === 0) {\r\n        return {\r\n            productImageUrl: '/productImage.png',\r\n            productImageHandles: {\r\n                center: { x: 300 / 600, y: 254 / 600, kind: S.ImageHandleKind.Anchor },\r\n                left_temple: { x: 58 / 600, y: 246 / 600, kind: S.ImageHandleKind.RotateAndScale },\r\n                right_temple: { x: 544 / 600, y: 248 / 600, kind: S.ImageHandleKind.RotateAndScale },\r\n                left_earpiece: { x: 18 / 600, y: 280 / 600 },\r\n                right_earpiece: { x: 583 / 600, y: 304 / 600 },\r\n            },\r\n        };\r\n    } else {\r\n        return {\r\n            productImageUrl: '/productImage02.png',\r\n            productImageHandles: {\r\n                center: { x: 296 / 600, y: 267 / 600, kind: S.ImageHandleKind.Anchor },\r\n                left_temple: { x: 58 / 600, y: 243 / 600, kind: S.ImageHandleKind.RotateAndScale },\r\n                right_temple: { x: 546 / 600, y: 251 / 600, kind: S.ImageHandleKind.RotateAndScale },\r\n                left_earpiece: { x: 10 / 600, y: 286 / 600 },\r\n                right_earpiece: { x: 595 / 600, y: 294 / 600 },\r\n            },\r\n        };\r\n    }\r\n}\r\n\r\nfunction getUser(i: number) {\r\n    if (i === 0) {\r\n        return {\r\n            userImageUrl: '/userImage00.png',\r\n            userImageHandles: {\r\n                left_temple: { x: 168 / 600, y: 260 / 600 },\r\n                right_temple: { x: 438 / 600, y: 260 / 600 },\r\n                left_earpiece: { x: 145 / 600, y: 278 / 600 },\r\n                right_earpiece: { x: 460 / 600, y: 292 / 600 },\r\n            },\r\n        };\r\n    } else if (i === 1) {\r\n        return {\r\n            userImageUrl: '/userImage01.png',\r\n            userImageHandles: {\r\n                left_temple: { x: 62 / 220, y: 78 / 215 },\r\n                right_temple: { x: 135 / 220, y: 78 / 215 },\r\n                left_earpiece: { x: 59 / 220, y: 83 / 215 },\r\n                right_earpiece: { x: 138 / 220, y: 78 / 215 },\r\n            },\r\n        };\r\n    } else  if (i === 2) {\r\n        return {\r\n            userImageUrl: '/userImage02.jpg',\r\n            userImageHandles: {\r\n                left_temple: { x: 170 / 600, y: 217 / 600 },\r\n                right_temple: { x: 406 / 600, y: 184 / 600 },\r\n                left_earpiece: { x: 150 / 600, y: 255 / 600 },\r\n                right_earpiece: { x: 425 / 600, y: 205 / 600 },\r\n            },\r\n        };\r\n    } else {\r\n        return {\r\n            userImageUrl: '/userImage03.png',\r\n            userImageHandles: {\r\n                left_temple: { x: 243 / 600, y: 316 / 600 },\r\n                right_temple: { x: 452 / 600, y: 207 / 600 },\r\n                left_earpiece: { x: 161 / 600, y: 282 / 600 },\r\n                right_earpiece: { x: 413 / 600, y: 186 / 600 },\r\n            },\r\n        };\r\n    }\r\n}\r\n\r\ntest();\n\n\n// WEBPACK FOOTER //\n// ./test/test.ts","export * from './user-fitting';\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","import { drawTriangle } from './draw-triangle';\r\n\r\nconst DEBUG = false;\r\nconst DEBUG_MOUSE = false;\r\n\r\nconst MAX_DRAG_DISTANCE_SQ = 0.05 * 0.05;\r\nconst MAX_MOVE_DISTANCE_SQ = 0.25 * 0.25;\r\nconst TIME_REMOVE_HANDLES = 3000;\r\nconst HANDLE_RADIUS = 4;\r\n\r\nconst MOVEMENT_RATIO = 0.5;\r\n\r\nexport enum ImageHandleKind {\r\n    Stretch,\r\n    RotateAndScale,\r\n    Anchor,\r\n}\r\nexport interface ImageHandle {\r\n    x: number;\r\n    y: number;\r\n    x_start?: number;\r\n    y_start?: number;\r\n    kind?: ImageHandleKind;\r\n}\r\nexport interface ImageHandles {\r\n    [key: string]: ImageHandle;\r\n}\r\n\r\nexport interface UserFittingOptions {\r\n    host: HTMLDivElement;\r\n    userImageUrl: string;\r\n    userImageHandles: ImageHandles;\r\n    productImageUrl: string;\r\n    productImageHandles: ImageHandles;\r\n}\r\n\r\nexport interface Rect {\r\n    y_top: number;\r\n    y_bottom: number;\r\n    x_left: number;\r\n    x_right: number;\r\n}\r\n\r\nexport interface SkewRect {\r\n    y_top_left: number;\r\n    y_bottom_left: number;\r\n    y_top_right: number;\r\n    y_bottom_right: number;\r\n    x_left: number;\r\n    x_right: number;\r\n}\r\n\r\nexport interface TransformCell {\r\n    source: Rect;\r\n    target: SkewRect;\r\n}\r\n\r\ninterface DrawContext {\r\n    width: number;\r\n    height: number;\r\n    context: CanvasRenderingContext2D;\r\n}\r\n\r\n\r\nexport function setupUserFitting(options: UserFittingOptions) {\r\n    let cvs = document.createElement('canvas');\r\n    options.host.appendChild(cvs);\r\n    cvs.width = options.host.clientWidth;\r\n    cvs.height = options.host.clientHeight;\r\n\r\n    let w = cvs.width | 600;\r\n    let h = cvs.height | 600;\r\n\r\n    // // Oversize to be able to see better\r\n    // if (DEBUG) {\r\n    //     cvs.width = 1200;\r\n    //     cvs.height = 800;\r\n\r\n    //     w = 600;\r\n    //     h = 600;\r\n    // }\r\n\r\n    let ctx = cvs.getContext('2d');\r\n\r\n    if (DEBUG) {\r\n        ctx.strokeStyle = '#000000';\r\n        ctx.lineWidth = 4;\r\n        ctx.strokeRect(0, 0, w, h);\r\n    }\r\n    // TODO: Add Image Loader (for iOS)\r\n\r\n    let userImage = new Image();\r\n    userImage.onload = () => {\r\n\r\n        // ctx.save();\r\n        // ctx.globalAlpha = 0.15;\r\n        // ctx.drawImage(userImage, 0, 0);\r\n        // ctx.restore();\r\n        // c.width = userImage.width;\r\n        // c.height = userImage.height;\r\n\r\n        refresh();\r\n    };\r\n    userImage.src = options.userImageUrl;\r\n\r\n    let productImage = new Image();\r\n    productImage.onload = () => {\r\n\r\n        if (DEBUG) {\r\n            ctx.save();\r\n            ctx.globalAlpha = 0.15;\r\n            ctx.drawImage(productImage, 0, 0);\r\n            ctx.restore();\r\n        }\r\n\r\n        refresh();\r\n    };\r\n    productImage.src = options.productImageUrl;\r\n\r\n\r\n    let refresh = () => {\r\n        if (!userImage.width || !productImage.width) {\r\n            setTimeout(refresh, 250);\r\n            return;\r\n        }\r\n\r\n        let c = { context: ctx, width: w || 600, height: h || 600 };\r\n\r\n        if (!DEBUG) {\r\n            c.width = w = cvs.width;\r\n            c.height = h = cvs.height;\r\n        }\r\n\r\n        refreshUserFitting(c, userImage, productImage, options);\r\n    };\r\n\r\n    setTimeout(refresh, 250);\r\n\r\n    let userHandles: ImageHandle[] = [];\r\n\r\n    for (let k in options.userImageHandles) {\r\n        userHandles.push(options.userImageHandles[k]);\r\n    }\r\n\r\n    let getHandleInfo = (e: any) => {\r\n\r\n        let rect = cvs.getBoundingClientRect();\r\n        let xm = 0;\r\n        let ym = 0;\r\n\r\n        if (e.clientX != null) {\r\n            xm = e.clientX - rect.left;\r\n            ym = e.clientY - rect.top;\r\n        } else if (e.touches != null) {\r\n            xm = e.touches[0].clientX - rect.left;\r\n            ym = e.touches[0].clientY - rect.top;\r\n        }\r\n\r\n        if (DEBUG_MOUSE) {\r\n            console.log('Mouse Down', xm, ym, e);\r\n        }\r\n        let xh = xm / w;\r\n        let yh = ym / h;\r\n        let nearest = userHandles.map(s => ({ handle: s, distanceSq: (s.x - xh) * (s.x - xh) + (s.y - yh) * (s.y - yh) })).sort((a, b) => a.distanceSq - b.distanceSq)[0];\r\n\r\n        return { xh, yh, nearest };\r\n    };\r\n\r\n\r\n    let isMovingProduct = false;\r\n    let isDraggingNearest = false;\r\n    let xh_start = 0;\r\n    let yh_start = 0;\r\n    let hNearest: ImageHandle = null;\r\n\r\n    let dragEnd = () => isDraggingNearest = isMovingProduct = false;\r\n    let dragStart = (e: any) => {\r\n        let {xh, yh, nearest} = getHandleInfo(e);\r\n\r\n        xh_start = xh;\r\n        yh_start = yh;\r\n\r\n        userHandles.forEach(s => {\r\n            s.x_start = s.x;\r\n            s.y_start = s.y;\r\n        });\r\n\r\n        if (nearest.distanceSq < MAX_DRAG_DISTANCE_SQ) {\r\n            isDraggingNearest = true;\r\n            hNearest = nearest.handle;\r\n        } else if (nearest.distanceSq < MAX_MOVE_DISTANCE_SQ) {\r\n            isMovingProduct = true;\r\n        }\r\n\r\n        if (DEBUG_MOUSE) {\r\n            console.log('isDraggingPoint', isDraggingNearest, 'isMovingProduct', isMovingProduct);\r\n            drawHandles(ctx, w, h, userHandles, '#00FF00');\r\n            drawHandles(ctx, w, h, [nearest.handle], '#FF0000');\r\n        }\r\n    };\r\n\r\n    let timeoutId = -1;\r\n\r\n    let dragMove = (e: any) => {\r\n        if (!isDraggingNearest && !isMovingProduct) { return; }\r\n\r\n        // Move the nearest handle\r\n        let {xh, yh} = getHandleInfo(e);\r\n\r\n        if (isDraggingNearest) {\r\n            let s = hNearest;\r\n            s.x = s.x_start + (xh - xh_start) * MOVEMENT_RATIO;\r\n            s.y = s.y_start + (yh - yh_start) * MOVEMENT_RATIO;\r\n        } else if (isMovingProduct) {\r\n            userHandles.forEach(s => {\r\n                s.x = s.x_start + (xh - xh_start) * MOVEMENT_RATIO;\r\n                s.y = s.y_start + (yh - yh_start) * MOVEMENT_RATIO;\r\n            });\r\n        }\r\n\r\n        refresh();\r\n\r\n        // if (DEBUG_MOUSE) {\r\n        drawHandles(ctx, w, h, userHandles, '#0000FF');\r\n        if (isDraggingNearest) {\r\n            drawHandles(ctx, w, h, [hNearest], '#00FF00');\r\n        }\r\n        // }\r\n\r\n        let removeHandles = () => {\r\n            clearTimeout(timeoutId);\r\n            timeoutId = setTimeout(() => {\r\n                if (isDraggingNearest) { removeHandles(); return; }\r\n                refresh();\r\n            }, TIME_REMOVE_HANDLES);\r\n        };\r\n\r\n        removeHandles();\r\n\r\n        e.preventDefault();\r\n        return false;\r\n    };\r\n\r\n    cvs.addEventListener('mousedown', dragStart);\r\n    cvs.addEventListener('touchstart', dragStart);\r\n    window.addEventListener('mouseup', dragEnd);\r\n    window.addEventListener('touchend', dragEnd);\r\n    window.addEventListener('mousemove', dragMove);\r\n    window.addEventListener('touchmove', dragMove);\r\n}\r\n\r\nfunction log(message: any, ...args: any[]) {\r\n    if (DEBUG) {\r\n        console.log(message, ...args);\r\n    }\r\n}\r\n\r\n\r\nfunction refreshUserFitting(c: DrawContext, userImage: HTMLImageElement, productImage: HTMLImageElement, options: UserFittingOptions) {\r\n    log('refresh');\r\n\r\n    drawImage(c, userImage, options.userImageHandles, options.userImageHandles);\r\n    drawImage(c, productImage, options.productImageHandles, options.userImageHandles);\r\n}\r\n\r\nfunction drawImage(c: DrawContext, image: HTMLImageElement, handles: ImageHandles, handleTargets: ImageHandles) {\r\n    let ctx = c.context;\r\n    let w = c.width;\r\n    let h = c.height;\r\n\r\n    let handlesMerged: { source: ImageHandle, target: ImageHandle }[] = [];\r\n\r\n    for (let k in handles) {\r\n        handlesMerged.push({ source: handles[k], target: handleTargets[k] });\r\n    }\r\n\r\n    handlesMerged = handlesMerged.sort((a, b) => a.source.x - b.source.x);\r\n\r\n    // Just do a row of cells for now (only vertical dividers)\r\n    let handles_stretches = handlesMerged.filter(x => x.source.kind !== ImageHandleKind.Anchor);\r\n\r\n    let gaps = handles_stretches.map((s, i) => ({ i: i, prev: s, next: handles_stretches[i + 1], xDistance: (handles_stretches[i + 1] || { source: { x: s.source.x } }).source.x - s.source.x }));\r\n    gaps.sort((a, b) => b.xDistance - a.xDistance);\r\n    // log('gaps', gaps);\r\n\r\n    let widest = gaps[0];\r\n\r\n    let targetScale =\r\n        (widest.next.target.x - widest.prev.target.x) /\r\n        (widest.next.source.x - widest.prev.source.x);\r\n\r\n    let y_delta_source = widest.next.source.y - widest.prev.source.y;\r\n    let x_delta_source = widest.next.source.x - widest.prev.source.x;\r\n    let y_delta_target = widest.next.target.y - widest.prev.target.y;\r\n    let x_delta_target = widest.next.target.x - widest.prev.target.x;\r\n\r\n    let sourceAngle = Math.atan(y_delta_source / x_delta_source);\r\n    let targetAngle = Math.atan(y_delta_target / x_delta_target);\r\n    let mainAngle = targetAngle - sourceAngle;\r\n\r\n    // TEMP: Testing\r\n    // mainAngle = 0;\r\n\r\n    log('targetScale', targetScale,\r\n        'y_delta_source', y_delta_source,\r\n        'x_delta_source', x_delta_source,\r\n        'y_delta_target', y_delta_target,\r\n        'x_delta_target', x_delta_target,\r\n        'sourceAngle', sourceAngle * 180 / Math.PI,\r\n        'targetAngle', targetAngle * 180 / Math.PI,\r\n        'mainAngle', mainAngle * 180 / Math.PI,\r\n    );\r\n\r\n    ctx.save();\r\n    ctx.rotate(mainAngle);\r\n\r\n    // Calculate y_top and y_bottom for each stretch handle\r\n    let stretches = handles_stretches.map(s => {\r\n        let sourceLeft_yRatioFromTop = s.source.y;\r\n        let sourceLeft_yRatioFromBottom = 1 - sourceLeft_yRatioFromTop;\r\n\r\n        let targetTop = s.target.y - targetScale * sourceLeft_yRatioFromTop;\r\n        let targetBottom = s.target.y + targetScale * sourceLeft_yRatioFromBottom;\r\n\r\n        return {\r\n            source: s.source,\r\n            target_orig: s.target,\r\n            target: rotate(s.target, -mainAngle),\r\n            y_top_target: rotateY(s.target.x, targetTop, -mainAngle),\r\n            y_bottom_target: rotateY(s.target.x, targetBottom, -mainAngle),\r\n        };\r\n    });\r\n\r\n\r\n    let columnCount = stretches.length - 1;\r\n\r\n    let grid: TransformCell[][] = [];\r\n\r\n    gaps.reverse();\r\n    let columnOrder: number[] = gaps.filter(g => g.xDistance > 0).map(g => g.i);\r\n\r\n    for (let ico = 0; ico < columnCount; ico++) {\r\n\r\n        let i = columnOrder[ico];\r\n        let sourceTop = 0;\r\n        let sourceBottom = 1;\r\n\r\n        let left = stretches[i];\r\n        let right = stretches[i + 1];\r\n\r\n        let sourceLeft = left.source.x;\r\n        let sourceRight = right.source.x;\r\n\r\n        let targetLeft = left.target.x;\r\n        let targetRight = right.target.x;\r\n\r\n        // Calculate the y scale\r\n        let target_top_left = left.y_top_target;\r\n        let target_bottom_left = left.y_bottom_target;\r\n\r\n        let target_top_right = right.y_top_target;\r\n        let target_bottom_right = right.y_bottom_target;\r\n\r\n        if (i === 0) {\r\n            let changeRatio = (sourceRight - 0) / (sourceRight - sourceLeft);\r\n            let targetPerSourceScale = (targetRight - targetLeft) / (sourceRight - sourceLeft);\r\n            targetLeft = targetRight - targetPerSourceScale * sourceRight;\r\n            sourceLeft = 0;\r\n\r\n            target_top_left = target_top_right - changeRatio * (target_top_right - target_top_left);\r\n            target_bottom_left = target_bottom_right - changeRatio * (target_bottom_right - target_bottom_left);\r\n        }\r\n\r\n        if (i === columnCount - 1) {\r\n            let changeRatio = (1 - sourceLeft) / (sourceRight - sourceLeft);\r\n            let tScale = (targetRight - targetLeft) / (sourceRight - sourceLeft);\r\n            targetRight = targetLeft + tScale * (1 - sourceLeft);\r\n            sourceRight = 1;\r\n\r\n            target_top_right = target_top_left + changeRatio * (target_top_right - target_top_left);\r\n            target_bottom_right = target_bottom_left + changeRatio * (target_bottom_right - target_bottom_left);\r\n        }\r\n\r\n\r\n        grid.push([{\r\n            source: { x_left: sourceLeft, x_right: sourceRight, y_top: sourceTop, y_bottom: sourceBottom },\r\n            target: { x_left: targetLeft, x_right: targetRight, y_top_left: target_top_left, y_bottom_left: target_bottom_left, y_top_right: target_top_right, y_bottom_right: target_bottom_right }\r\n        }]);\r\n\r\n\r\n        let g = grid[grid.length - 1][0];\r\n\r\n        log('Source:', g.source);\r\n        log('Target:', g.target);\r\n\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.source.x_left, h * g.source.y_top,\r\n        //     w * g.source.x_right, h * g.source.y_top,\r\n        //     w * g.source.x_left, h * g.source.y_bottom,\r\n        //     image.width * g.source.x_left, image.height * g.source.y_top,\r\n        //     image.width * g.source.x_right, image.height * g.source.y_top,\r\n        //     image.width * g.source.x_left, image.height * g.source.y_bottom\r\n        // );\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.source.x_right, h * g.source.y_top,\r\n        //     w * g.source.x_right, h * g.source.y_bottom,\r\n        //     w * g.source.x_left, h * g.source.y_bottom,\r\n        //     image.width * g.source.x_right, image.height * g.source.y_top,\r\n        //     image.width * g.source.x_right, image.height * g.source.y_bottom,\r\n        //     image.width * g.source.x_left, image.height * g.source.y_bottom\r\n        // );\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.target.x_left, h * g.target.y_top,\r\n        //     w * g.target.x_right, h * g.target.y_top,\r\n        //     w * g.target.x_left, h * g.target.y_bottom,\r\n        //     image.width * g.target.x_left, image.height * g.target.y_top,\r\n        //     image.width * g.target.x_right, image.height * g.target.y_top,\r\n        //     image.width * g.target.x_left, image.height * g.target.y_bottom\r\n        // );\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.target.x_right, h * g.target.y_top,\r\n        //     w * g.target.x_right, h * g.target.y_bottom,\r\n        //     w * g.target.x_left, h * g.target.y_bottom,\r\n        //     image.width * g.target.x_right, image.height * g.target.y_top,\r\n        //     image.width * g.target.x_right, image.height * g.target.y_bottom,\r\n        //     image.width * g.target.x_left, image.height * g.target.y_bottom\r\n        // );\r\n\r\n        drawTriangle(ctx, image,\r\n            w * g.target.x_left, h * g.target.y_top_left,\r\n            w * g.target.x_right, h * g.target.y_top_right,\r\n            w * g.target.x_left, h * g.target.y_bottom_left,\r\n            image.width * g.source.x_left, image.height * g.source.y_top,\r\n            image.width * g.source.x_right, image.height * g.source.y_top,\r\n            image.width * g.source.x_left, image.height * g.source.y_bottom, DEBUG\r\n        );\r\n\r\n        drawTriangle(ctx, image,\r\n            w * g.target.x_right, h * g.target.y_top_right,\r\n            w * g.target.x_right, h * g.target.y_bottom_right,\r\n            w * g.target.x_left, h * g.target.y_bottom_left,\r\n            image.width * g.source.x_right, image.height * g.source.y_top,\r\n            image.width * g.source.x_right, image.height * g.source.y_bottom,\r\n            image.width * g.source.x_left, image.height * g.source.y_bottom, DEBUG\r\n        );\r\n\r\n        // break;\r\n    }\r\n\r\n    if (DEBUG) {\r\n\r\n        stretches.forEach(s => {\r\n            log('draw stretch', s);\r\n            ctx.beginPath();\r\n            ctx.strokeStyle = '#FF00FF';\r\n            ctx.moveTo(w * s.target_orig.x, h * s.target_orig.y);\r\n            ctx.lineTo(w * s.target.x, h * s.target.y);\r\n            ctx.stroke();\r\n            // ctx.beginPath();\r\n            // ctx.strokeStyle = '#00FFFF';\r\n            // ctx.moveTo(w * s.target.x, h * s.target.x);\r\n            // ctx.stroke();\r\n        });\r\n\r\n        drawHandles(ctx, w, h, stretches.map(s => s.target) as any as ImageHandles, '#FF00FF');\r\n        drawHandles(ctx, w, h, handles, '#FF0000');\r\n        drawHandles(ctx, w, h, handleTargets, '#00FF00');\r\n    }\r\n\r\n    ctx.restore();\r\n}\r\n\r\nfunction rotate(handle: ImageHandle, angle: number): ImageHandle {\r\n    let x_rotate = handle.x * Math.cos(angle) - handle.y * Math.sin(angle);\r\n    let y_rotate = handle.x * Math.sin(angle) + handle.y * Math.cos(angle);\r\n\r\n    return {\r\n        kind: handle.kind,\r\n        x: x_rotate,\r\n        y: y_rotate,\r\n    };\r\n}\r\n\r\nfunction rotateY(x: number, y: number, angle: number): number {\r\n    let y_rotate = x * Math.sin(angle) + y * Math.cos(angle);\r\n\r\n    return y_rotate;\r\n}\r\n\r\nfunction calculateScale(s0: number, s1: number, t0: number, t1: number) {\r\n    // if (s0 <= s1 || t0 <= t1) { return 0; }\r\n    return (t1 - t0) / (s1 - s0);\r\n}\r\n\r\nfunction calculateSkewY(sx0: number, sx1: number, sy0: number, sy1: number, ty0: number, ty1: number) {\r\n    let dsx = sx1 - sx0;\r\n    let dsy = sy1 - sy0;\r\n    let dty = ty1 - ty0;\r\n\r\n    return (dty - dsy) / dsx;\r\n}\r\n\r\nfunction drawHandles(ctx: CanvasRenderingContext2D, w: number, h: number, handles: ImageHandles | ImageHandle[], color: string) {\r\n\r\n    let radius = HANDLE_RADIUS;\r\n    for (let k in handles) {\r\n        log('draw handle');\r\n\r\n        let handle = (handles as any)[k];\r\n        ctx.beginPath();\r\n        // ctx.lineWidth = 1;\r\n        // ctx.strokeStyle = color;\r\n        // ctx.moveTo(handle.x * w - len, handle.y * h);\r\n        // ctx.lineTo(handle.x * w + len, handle.y * h);\r\n        // ctx.moveTo(handle.x * w, handle.y * h - len);\r\n        // ctx.lineTo(handle.x * w, handle.y * h + len);\r\n        // ctx.stroke();\r\n\r\n        ctx.fillStyle = color;\r\n        ctx.arc(handle.x * w, handle.y * h, radius, 0, Math.PI * 2, false);\r\n        ctx.fill();\r\n    }\r\n\r\n\r\n}\r\n\r\nfunction drawImageSection(ctx: CanvasRenderingContext2D, image: HTMLImageElement, handle: ImageHandles, handleTargets: ImageHandles) {\r\n\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/user-fitting.ts","// Based on: jsgl.js https://github.com/spoulson/Code-snippets/blob/master/Javascript/jsgl/jsgl.js\r\nexport function drawTriangle(\r\n    ctx: CanvasRenderingContext2D,\r\n    image: HTMLImageElement,\r\n    x0: number,\r\n    y0: number,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    sx0: number,\r\n    sy0: number,\r\n    sx1: number,\r\n    sy1: number,\r\n    sx2: number,\r\n    sy2: number,\r\n    wireframe = false\r\n) {\r\n    if (wireframe) {\r\n        ctx.lineWidth = 0.5;\r\n        ctx.strokeStyle = '#00FF00';\r\n        ctx.beginPath();\r\n        ctx.moveTo(x0, y0);\r\n        ctx.lineTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.lineTo(x0, y0);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n\r\n        ctx.strokeStyle = '#0000FF';\r\n        ctx.beginPath();\r\n        ctx.moveTo(sx0, sy0);\r\n        ctx.lineTo(sx1, sy1);\r\n        ctx.lineTo(sx2, sy2);\r\n        ctx.lineTo(sx0, sy0);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n    }\r\n\r\n    // console.log(`Target: (${x0},${y0})-(${x1},${y1})-(${x2},${y2})`);\r\n    // console.log(`Source: (${sx0},${sy0})-(${sx1},${sy1})-(${sx2},${sy2})`);\r\n\r\n    ctx.save();\r\n\r\n    // Clip the output to the on-screen triangle boundaries.\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0, y0);\r\n    ctx.lineTo(x1, y1);\r\n    ctx.lineTo(x2, y2);\r\n    ctx.closePath();\r\n    // ctx.stroke();//xxxxxxx for wireframe\r\n    ctx.clip();\r\n\r\n    /*\r\n      ctx.transform(m11, m12, m21, m22, dx, dy) sets the context transform matrix.\r\n      The context matrix is:\r\n      [ m11 m21 dx ]\r\n      [ m12 m22 dy ]\r\n      [  0   0   1 ]\r\n      Coords are column vectors with a 1 in the z coord, so the transform is:\r\n      x_out = m11 * x + m21 * y + dx;\r\n      y_out = m12 * x + m22 * y + dy;\r\n      From Maxima, these are the transform values that map the source\r\n      coords to the dest coords:\r\n      sy0 (x2 - x1) - sy1 x2 + sy2 x1 + (sy1 - sy2) x0\r\n      [m11 = - -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sy1 y2 + sy0 (y1 - y2) - sy2 y1 + (sy2 - sy1) y0\r\n      m12 = -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx0 (x2 - x1) - sx1 x2 + sx2 x1 + (sx1 - sx2) x0\r\n      m21 = -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx1 y2 + sx0 (y1 - y2) - sx2 y1 + (sx2 - sx1) y0\r\n      m22 = - -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx0 (sy2 x1 - sy1 x2) + sy0 (sx1 x2 - sx2 x1) + (sx2 sy1 - sx1 sy2) x0\r\n      dx = ----------------------------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx0 (sy2 y1 - sy1 y2) + sy0 (sx1 y2 - sx2 y1) + (sx2 sy1 - sx1 sy2) y0\r\n      dy = ----------------------------------------------------------------------]\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n    */\r\n\r\n    // TODO: eliminate common subexpressions.\r\n    let denom = sx0 * (sy2 - sy1) - sx1 * sy2 + sx2 * sy1 + (sx1 - sx2) * sy0;\r\n    if (denom === 0) {\r\n        return;\r\n    }\r\n    let m11 = - (sy0 * (x2 - x1) - sy1 * x2 + sy2 * x1 + (sy1 - sy2) * x0) / denom;\r\n    let m12 = (sy1 * y2 + sy0 * (y1 - y2) - sy2 * y1 + (sy2 - sy1) * y0) / denom;\r\n    let m21 = (sx0 * (x2 - x1) - sx1 * x2 + sx2 * x1 + (sx1 - sx2) * x0) / denom;\r\n    let m22 = - (sx1 * y2 + sx0 * (y1 - y2) - sx2 * y1 + (sx2 - sx1) * y0) / denom;\r\n    let dx = (sx0 * (sy2 * x1 - sy1 * x2) + sy0 * (sx1 * x2 - sx2 * x1) + (sx2 * sy1 - sx1 * sy2) * x0) / denom;\r\n    let dy = (sx0 * (sy2 * y1 - sy1 * y2) + sy0 * (sx1 * y2 - sx2 * y1) + (sx2 * sy1 - sx1 * sy2) * y0) / denom;\r\n\r\n    ctx.transform(m11, m12, m21, m22, dx, dy);\r\n\r\n    // Draw the whole image.  Transform and clip will map it onto the\r\n    // correct output triangle.\r\n    //\r\n    // TODO: figure out if drawImage goes faster if we specify the rectangle that\r\n    // bounds the source coords.\r\n    ctx.drawImage(image, 0, 0);\r\n    ctx.restore();\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/draw-triangle.ts"],"sourceRoot":""}