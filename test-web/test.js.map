{"version":3,"sources":["webpack:///webpack/bootstrap c3afa4900249a4a7d688","webpack:///./test/test.ts","webpack:///./src/index.ts","webpack:///./src/user-fitting.ts","webpack:///./src/draw-triangle.ts"],"names":[],"mappings":"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","file":"./test-web/test.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c3afa4900249a4a7d688","import * as S from '../src';\r\n\r\nexport function test() {\r\n    console.log('test START');\r\n\r\n    let host = document.createElement('div');\r\n    document.body.appendChild(host);\r\n    host.style.width = '300px';\r\n    host.style.height = '300px';\r\n\r\n    S.setupUserFitting({\r\n        host: host,\r\n        productImageUrl: '/productImage.png',\r\n        productImageHandles: {\r\n            center: { x: 300 / 600, y: 254 / 600, kind: S.ImageHandleKind.Move },\r\n            left_temple: { x: 58 / 600, y: 246 / 600 },\r\n            right_temple: { x: 544 / 600, y: 248 / 600 },\r\n            left_earpiece: { x: 18 / 600, y: 280 / 600 },\r\n            right_earpiece: { x: 583 / 600, y: 304 / 600 },\r\n        },\r\n        // userImageUrl: '/userImage00.png',\r\n        // userImageHandles: {\r\n        //     center: { x: 302 / 600, y: 264 / 600, kind: S.ImageHandleKind.Move },\r\n        //     left_temple: { x: 168 / 600, y: 260 / 600 },\r\n        //     right_temple: { x: 438 / 600, y: 260 / 600 },\r\n        //     left_earpiece: { x: 145 / 600, y: 278 / 600 },\r\n        //     right_earpiece: { x: 460 / 600, y: 292 / 600 },\r\n        // },\r\n        // userImageUrl: '/userImage01.png',\r\n        // userImageHandles: {\r\n        //     center: { x: 97 / 220, y: 78 / 215, kind: S.ImageHandleKind.Move },\r\n        //     left_temple: { x: 62 / 220, y: 74 / 215 },\r\n        //     right_temple: { x: 133 / 220, y: 74 / 215 },\r\n        //     left_earpiece: { x: 59 / 220, y: 83 / 215 },\r\n        //     right_earpiece: { x: 138 / 220, y: 78 / 215 },\r\n        // },\r\n        userImageUrl: '/userImage02.jpg',\r\n        userImageHandles: {\r\n            center: { x: 286 / 600, y: 202 / 600, kind: S.ImageHandleKind.Move },\r\n            left_temple: { x: 166 / 600, y: 217 / 600 },\r\n            right_temple: { x: 400 / 600, y: 175 / 600 },\r\n            left_earpiece: { x: 150 / 600, y: 255 / 600 },\r\n            right_earpiece: { x: 425 / 600, y: 205 / 600 },\r\n        },\r\n\r\n\r\n    });\r\n\r\n    console.log('test END');\r\n}\r\n\r\ntest();\n\n\n// WEBPACK FOOTER //\n// ./test/test.ts","export * from './user-fitting';\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","import { drawTriangle } from './draw-triangle';\r\n\r\nexport enum ImageHandleKind {\r\n    Stretch,\r\n    Move,\r\n}\r\nexport interface ImageHandle {\r\n    x: number;\r\n    y: number;\r\n    kind?: ImageHandleKind;\r\n}\r\nexport interface ImageHandles {\r\n    [key: string]: ImageHandle;\r\n}\r\n\r\nexport interface UserFittingOptions {\r\n    host: HTMLDivElement;\r\n    userImageUrl: string;\r\n    userImageHandles: ImageHandles;\r\n    productImageUrl: string;\r\n    productImageHandles: ImageHandles;\r\n}\r\n\r\nexport interface Rect {\r\n    y_top: number;\r\n    y_bottom: number;\r\n    x_left: number;\r\n    x_right: number;\r\n}\r\n\r\nexport interface SkewRect {\r\n    y_top_left: number;\r\n    y_bottom_left: number;\r\n    y_top_right: number;\r\n    y_bottom_right: number;\r\n    x_left: number;\r\n    x_right: number;\r\n}\r\n\r\nexport interface TransformCell {\r\n    source: Rect;\r\n    target: SkewRect;\r\n}\r\n\r\ninterface DrawContext {\r\n    width: number;\r\n    height: number;\r\n    context: CanvasRenderingContext2D;\r\n}\r\n\r\n\r\nexport function setupUserFitting(options: UserFittingOptions) {\r\n    let cvs = document.createElement('canvas');\r\n    options.host.appendChild(cvs);\r\n\r\n    // Oversize to be able to see better\r\n    cvs.width = 1200;\r\n    cvs.height = 800;\r\n\r\n    let w = 600;\r\n    let h = 600;\r\n\r\n    let ctx = cvs.getContext('2d');\r\n\r\n    ctx.strokeStyle = '#000000';\r\n    ctx.lineWidth = 4;\r\n    ctx.strokeRect(0, 0, w, h);\r\n\r\n    // TODO: Add Image Loader (for iOS)\r\n\r\n    let userImage = new Image();\r\n    userImage.src = options.userImageUrl;\r\n    userImage.onload = () => {\r\n\r\n        // ctx.save();\r\n        // ctx.globalAlpha = 0.15;\r\n        // ctx.drawImage(userImage, 0, 0);\r\n        // ctx.restore();\r\n        // c.width = userImage.width;\r\n        // c.height = userImage.height;\r\n\r\n        refresh();\r\n    };\r\n\r\n    let productImage = new Image();\r\n    productImage.src = options.productImageUrl;\r\n    productImage.onload = () => {\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = 0.15;\r\n        ctx.drawImage(productImage, 0, 0);\r\n        ctx.restore();\r\n\r\n        refresh();\r\n    };\r\n\r\n    let c = { context: ctx, width: w, height: h };\r\n    let refresh = () => {\r\n\r\n\r\n\r\n        refreshUserFitting(c, userImage, productImage, options);\r\n    };\r\n\r\n    setTimeout(refresh);\r\n\r\n    cvs.onmousemove = () => refresh();\r\n}\r\n\r\n\r\nfunction refreshUserFitting(c: DrawContext, userImage: HTMLImageElement, productImage: HTMLImageElement, options: UserFittingOptions) {\r\n    console.log('refresh');\r\n\r\n    drawImage(c, userImage, options.userImageHandles, options.userImageHandles);\r\n    drawImage(c, productImage, options.productImageHandles, options.userImageHandles);\r\n}\r\n\r\nfunction drawImage(c: DrawContext, image: HTMLImageElement, handles: ImageHandles, handleTargets: ImageHandles) {\r\n    let ctx = c.context;\r\n    let w = c.width;\r\n    let h = c.height;\r\n\r\n    let handlesMerged: { from: ImageHandle, to: ImageHandle }[] = [];\r\n\r\n    for (let k in handles) {\r\n        handlesMerged.push({ from: handles[k], to: handleTargets[k] });\r\n    }\r\n\r\n    handlesMerged = handlesMerged.sort((a, b) => a.from.x - b.from.x);\r\n\r\n    // Just do a row of cells for now (only vertical dividers)\r\n    let handles_stretches = handlesMerged.filter(x => x.from.kind !== ImageHandleKind.Move);\r\n\r\n    let gaps = handles_stretches.map((s, i) => ({ prev: s, next: handles_stretches[i + 1], xDistance: (handles_stretches[i + 1] || { from: { x: s.from.x } }).from.x - s.from.x }));\r\n    gaps.sort((a, b) => b.xDistance - a.xDistance);\r\n    let widest = gaps[0];\r\n\r\n    let targetScale =\r\n        (widest.next.to.x - widest.prev.to.x) /\r\n        (widest.next.from.x - widest.prev.from.x);\r\n\r\n    console.log('targetScale', targetScale);\r\n\r\n\r\n    // Calculate y_top and y_bottom for each stretch handle\r\n    let stretches = handles_stretches.map(x => {\r\n        let sourceLeft_yRatioFromTop = x.from.y;\r\n        let sourceLeft_yRatioFromBottom = 1 - sourceLeft_yRatioFromTop;\r\n\r\n        let targetTop = x.to.y - targetScale * sourceLeft_yRatioFromTop;\r\n        let targetBottom = x.to.y + targetScale * sourceLeft_yRatioFromBottom;\r\n\r\n        return {\r\n            ...x,\r\n            y_top_target: targetTop,\r\n            y_bottom_target: targetBottom,\r\n        };\r\n    });\r\n\r\n\r\n    let columnCount = stretches.length - 1;\r\n\r\n    let grid: TransformCell[][] = [];\r\n\r\n    for (let i = 0; i < columnCount; i++) {\r\n\r\n        let sourceTop = 0;\r\n        let sourceBottom = 1;\r\n\r\n        let left = stretches[i];\r\n        let right = stretches[i + 1];\r\n\r\n        let sourceLeft = left.from.x;\r\n        let sourceRight = right.from.x;\r\n\r\n        let targetLeft = left.to.x;\r\n        let targetRight = right.to.x;\r\n\r\n        // Calculate the y scale\r\n        let target_top_left = left.y_top_target;\r\n        let target_bottom_left = left.y_bottom_target;\r\n\r\n        let target_top_right = right.y_top_target;\r\n        let target_bottom_right = right.y_bottom_target;\r\n\r\n        if (i === 0) {\r\n            let changeRatio = (sourceRight - 0) / (sourceRight - sourceLeft);\r\n            let targetPerSourceScale = (targetRight - targetLeft) / (sourceRight - sourceLeft);\r\n            targetLeft = targetRight - targetPerSourceScale * sourceRight;\r\n            sourceLeft = 0;\r\n\r\n            target_top_left = target_top_right - changeRatio * (target_top_right - target_top_left);\r\n            target_bottom_left = target_bottom_right - changeRatio * (target_bottom_right - target_bottom_left);\r\n        }\r\n\r\n        if (i === columnCount - 1) {\r\n            let changeRatio = (1 - sourceRight) / (sourceRight - sourceLeft);\r\n            let tScale = (targetRight - targetLeft) / (sourceRight - sourceLeft);\r\n            targetRight = targetLeft + tScale * (1 - sourceLeft);\r\n            sourceRight = 1;\r\n\r\n            target_top_right = target_top_left + changeRatio * (target_top_right - target_top_left);\r\n            target_bottom_right = target_bottom_left + changeRatio * (target_bottom_right - target_bottom_left);\r\n        }\r\n\r\n\r\n        grid.push([{\r\n            source: { x_left: sourceLeft, x_right: sourceRight, y_top: sourceTop, y_bottom: sourceBottom },\r\n            target: { x_left: targetLeft, x_right: targetRight, y_top_left: target_top_left, y_bottom_left: target_bottom_left, y_top_right: target_top_right, y_bottom_right: target_bottom_right }\r\n        }]);\r\n\r\n\r\n        let g = grid[grid.length - 1][0];\r\n\r\n        console.log('Source:', g.source);\r\n        console.log('Target:', g.target);\r\n\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.source.x_left, h * g.source.y_top,\r\n        //     w * g.source.x_right, h * g.source.y_top,\r\n        //     w * g.source.x_left, h * g.source.y_bottom,\r\n        //     image.width * g.source.x_left, image.height * g.source.y_top,\r\n        //     image.width * g.source.x_right, image.height * g.source.y_top,\r\n        //     image.width * g.source.x_left, image.height * g.source.y_bottom\r\n        // );\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.source.x_right, h * g.source.y_top,\r\n        //     w * g.source.x_right, h * g.source.y_bottom,\r\n        //     w * g.source.x_left, h * g.source.y_bottom,\r\n        //     image.width * g.source.x_right, image.height * g.source.y_top,\r\n        //     image.width * g.source.x_right, image.height * g.source.y_bottom,\r\n        //     image.width * g.source.x_left, image.height * g.source.y_bottom\r\n        // );\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.target.x_left, h * g.target.y_top,\r\n        //     w * g.target.x_right, h * g.target.y_top,\r\n        //     w * g.target.x_left, h * g.target.y_bottom,\r\n        //     image.width * g.target.x_left, image.height * g.target.y_top,\r\n        //     image.width * g.target.x_right, image.height * g.target.y_top,\r\n        //     image.width * g.target.x_left, image.height * g.target.y_bottom\r\n        // );\r\n\r\n        // drawTriangle(ctx, image,\r\n        //     w * g.target.x_right, h * g.target.y_top,\r\n        //     w * g.target.x_right, h * g.target.y_bottom,\r\n        //     w * g.target.x_left, h * g.target.y_bottom,\r\n        //     image.width * g.target.x_right, image.height * g.target.y_top,\r\n        //     image.width * g.target.x_right, image.height * g.target.y_bottom,\r\n        //     image.width * g.target.x_left, image.height * g.target.y_bottom\r\n        // );\r\n\r\n        drawTriangle(ctx, image,\r\n            w * g.target.x_left, h * g.target.y_top_left,\r\n            w * g.target.x_right, h * g.target.y_top_right,\r\n            w * g.target.x_left, h * g.target.y_bottom_left,\r\n            image.width * g.source.x_left, image.height * g.source.y_top,\r\n            image.width * g.source.x_right, image.height * g.source.y_top,\r\n            image.width * g.source.x_left, image.height * g.source.y_bottom,// false\r\n        );\r\n\r\n        drawTriangle(ctx, image,\r\n            w * g.target.x_right, h * g.target.y_top_right,\r\n            w * g.target.x_right, h * g.target.y_bottom_right,\r\n            w * g.target.x_left, h * g.target.y_bottom_left,\r\n            image.width * g.source.x_right, image.height * g.source.y_top,\r\n            image.width * g.source.x_right, image.height * g.source.y_bottom,\r\n            image.width * g.source.x_left, image.height * g.source.y_bottom,// false\r\n        );\r\n\r\n        // break;\r\n    }\r\n\r\n    // Match edges\r\n\r\n\r\n    // for (let i = 0; i < grid.length; i++) {\r\n    //     console.log('draw column');\r\n    //     let column = grid[i];\r\n    //     for (let j = 0; j < column.length; j++) {\r\n    //         let cell = column[j];\r\n    //         ctx.drawImage(image,\r\n    //             image.width * cell.source.x_left,\r\n    //             image.height * cell.source.x_right,\r\n    //             image.width * (cell.source.x_right - cell.source.x_left),\r\n    //             image.height * (cell.source.y_bottom - cell.source.y_top),\r\n    //             image.width * cell.target.x_left,\r\n    //             image.height * cell.target.y_top,\r\n    //             image.width * (cell.target.x_right - cell.target.x_left),\r\n    //             image.height * (cell.target.y_bottom - cell.target.y_top)\r\n    //         );\r\n\r\n    //         console.log(image,\r\n    //             '\\n',\r\n    //             's_x', cell.source.x_left,\r\n    //             's_y', cell.source.x_right,\r\n    //             's_w', (cell.source.x_right - cell.source.x_left),\r\n    //             's_h', (cell.source.y_bottom - cell.source.y_top),\r\n    //             '\\n',\r\n    //             't_x', cell.target.x_left,\r\n    //             't_y', cell.target.y_top,\r\n    //             't_w', (cell.target.x_right - cell.target.x_left),\r\n    //             't_h', (cell.target.y_bottom - cell.target.y_top)\r\n    //         );\r\n\r\n    //     }\r\n\r\n    //     // TESTING\r\n    //     // break;\r\n    // }\r\n\r\n    // ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, w, h);\r\n\r\n    drawHandles(ctx, w, h, handles, '#FF0000');\r\n    drawHandles(ctx, w, h, handleTargets, '#00FF00');\r\n}\r\n\r\nfunction calculateScale(s0: number, s1: number, t0: number, t1: number) {\r\n    // if (s0 <= s1 || t0 <= t1) { return 0; }\r\n    return (t1 - t0) / (s1 - s0);\r\n}\r\n\r\nfunction calculateSkewY(sx0: number, sx1: number, sy0: number, sy1: number, ty0: number, ty1: number) {\r\n    let dsx = sx1 - sx0;\r\n    let dsy = sy1 - sy0;\r\n    let dty = ty1 - ty0;\r\n\r\n    return (dty - dsy) / dsx;\r\n}\r\n\r\nfunction drawHandles(ctx: CanvasRenderingContext2D, w: number, h: number, handles: ImageHandles, color: string) {\r\n    const len = 10;\r\n    for (let k in handles) {\r\n        console.log('draw handle');\r\n\r\n        let handle = handles[k];\r\n        ctx.beginPath();\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeStyle = color;\r\n        ctx.moveTo(handle.x * w - len, handle.y * h);\r\n        ctx.lineTo(handle.x * w + len, handle.y * h);\r\n        ctx.moveTo(handle.x * w, handle.y * h - len);\r\n        ctx.lineTo(handle.x * w, handle.y * h + len);\r\n        ctx.stroke();\r\n    }\r\n\r\n\r\n}\r\n\r\nfunction drawImageSection(ctx: CanvasRenderingContext2D, image: HTMLImageElement, handle: ImageHandles, handleTargets: ImageHandles) {\r\n\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/user-fitting.ts","// Based on: jsgl.js https://github.com/spoulson/Code-snippets/blob/master/Javascript/jsgl/jsgl.js\r\nexport function drawTriangle(\r\n    ctx: CanvasRenderingContext2D,\r\n    image: HTMLImageElement,\r\n    x0: number,\r\n    y0: number,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    sx0: number,\r\n    sy0: number,\r\n    sx1: number,\r\n    sy1: number,\r\n    sx2: number,\r\n    sy2: number,\r\n    wireframe = true\r\n) {\r\n    if (wireframe) {\r\n        ctx.lineWidth = 0.5;\r\n        ctx.strokeStyle = '#00FF00';\r\n        ctx.beginPath();\r\n        ctx.moveTo(x0, y0);\r\n        ctx.lineTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.lineTo(x0, y0);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n\r\n        ctx.strokeStyle = '#0000FF';\r\n        ctx.beginPath();\r\n        ctx.moveTo(sx0, sy0);\r\n        ctx.lineTo(sx1, sy1);\r\n        ctx.lineTo(sx2, sy2);\r\n        ctx.lineTo(sx0, sy0);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n    }\r\n\r\n    console.log(`Target: (${x0},${y0})-(${x1},${y1})-(${x2},${y2})`);\r\n    console.log(`Source: (${sx0},${sy0})-(${sx1},${sy1})-(${sx2},${sy2})`);\r\n\r\n    ctx.save();\r\n\r\n    // Clip the output to the on-screen triangle boundaries.\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0, y0);\r\n    ctx.lineTo(x1, y1);\r\n    ctx.lineTo(x2, y2);\r\n    ctx.closePath();\r\n    // ctx.stroke();//xxxxxxx for wireframe\r\n    ctx.clip();\r\n\r\n    /*\r\n      ctx.transform(m11, m12, m21, m22, dx, dy) sets the context transform matrix.\r\n      The context matrix is:\r\n      [ m11 m21 dx ]\r\n      [ m12 m22 dy ]\r\n      [  0   0   1 ]\r\n      Coords are column vectors with a 1 in the z coord, so the transform is:\r\n      x_out = m11 * x + m21 * y + dx;\r\n      y_out = m12 * x + m22 * y + dy;\r\n      From Maxima, these are the transform values that map the source\r\n      coords to the dest coords:\r\n      sy0 (x2 - x1) - sy1 x2 + sy2 x1 + (sy1 - sy2) x0\r\n      [m11 = - -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sy1 y2 + sy0 (y1 - y2) - sy2 y1 + (sy2 - sy1) y0\r\n      m12 = -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx0 (x2 - x1) - sx1 x2 + sx2 x1 + (sx1 - sx2) x0\r\n      m21 = -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx1 y2 + sx0 (y1 - y2) - sx2 y1 + (sx2 - sx1) y0\r\n      m22 = - -----------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx0 (sy2 x1 - sy1 x2) + sy0 (sx1 x2 - sx2 x1) + (sx2 sy1 - sx1 sy2) x0\r\n      dx = ----------------------------------------------------------------------,\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n      sx0 (sy2 y1 - sy1 y2) + sy0 (sx1 y2 - sx2 y1) + (sx2 sy1 - sx1 sy2) y0\r\n      dy = ----------------------------------------------------------------------]\r\n      sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0\r\n    */\r\n\r\n    // TODO: eliminate common subexpressions.\r\n    let denom = sx0 * (sy2 - sy1) - sx1 * sy2 + sx2 * sy1 + (sx1 - sx2) * sy0;\r\n    if (denom === 0) {\r\n        return;\r\n    }\r\n    let m11 = - (sy0 * (x2 - x1) - sy1 * x2 + sy2 * x1 + (sy1 - sy2) * x0) / denom;\r\n    let m12 = (sy1 * y2 + sy0 * (y1 - y2) - sy2 * y1 + (sy2 - sy1) * y0) / denom;\r\n    let m21 = (sx0 * (x2 - x1) - sx1 * x2 + sx2 * x1 + (sx1 - sx2) * x0) / denom;\r\n    let m22 = - (sx1 * y2 + sx0 * (y1 - y2) - sx2 * y1 + (sx2 - sx1) * y0) / denom;\r\n    let dx = (sx0 * (sy2 * x1 - sy1 * x2) + sy0 * (sx1 * x2 - sx2 * x1) + (sx2 * sy1 - sx1 * sy2) * x0) / denom;\r\n    let dy = (sx0 * (sy2 * y1 - sy1 * y2) + sy0 * (sx1 * y2 - sx2 * y1) + (sx2 * sy1 - sx1 * sy2) * y0) / denom;\r\n\r\n    ctx.transform(m11, m12, m21, m22, dx, dy);\r\n\r\n    // Draw the whole image.  Transform and clip will map it onto the\r\n    // correct output triangle.\r\n    //\r\n    // TODO: figure out if drawImage goes faster if we specify the rectangle that\r\n    // bounds the source coords.\r\n    ctx.drawImage(image, 0, 0);\r\n    ctx.restore();\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/draw-triangle.ts"],"sourceRoot":""}